<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leadsheet Generator - Editor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Merriweather:ital,wght@0,400;0,700;1,400&family=Roboto:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Dancing+Script:wght@400;700&family=Caveat:wght@400;700&family=Noto+Music&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="generator.css">
    <style>
      .back-to-home {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1100;
        background-color: #fff;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        text-decoration: none;
        color: #007bff;
        font-weight: 600;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        transition: all 0.2s ease;
      }
      .back-to-home:hover {
        background-color: #f8f9fa;
        transform: translateY(-1px);
      }
      @media print {
        .back-to-home {
          display: none !important;
        }
      }
    </style>
</head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    
    <a href="index.html" class="back-to-home">&larr; Back to Home</a>

    <div class="app-container">
      <main class="main-content">
        <div class="sheet-panel" aria-label="Lead Sheet Preview">
          
          <!-- Header Editor Toolbar -->
          <div id="header-editor-toolbar" class="header-editor-toolbar hidden">
              <div class="toolbar-group">
                  <label for="font-family-select">Font:</label>
                  <select id="font-family-select"></select>
              </div>
              <div class="toolbar-group">
                  <label for="font-size-input">Size:</label>
                  <input type="number" id="font-size-input" min="10" max="100" />
              </div>
          </div>

          <div class="sheet-music" id="sheet-music">
            <!-- Sheet content will be generated by JavaScript -->
          </div>
        </div>
      </main>
      
      <button id="add-line-btn" class="app-button add-line-button">
        New Line
      </button>
      <button id="help-btn" class="app-button help-button">
        ?
      </button>
      <button id="print-pdf-btn" class="app-button print-button">
        Print / PDF
      </button>
      <button id="export-png-btn" class="app-button export-button">
        Export as PNG
      </button>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="modal-close-btn" class="modal-close-btn">&times;</button>
            <h2>Help & Guide</h2>
            <p><strong>General Usage:</strong> All elements on the lead sheet can be clicked directly to edit them. Clicking outside an element saves the change.</p>
            
            <dl>
                <dt>Header (Title, etc.)</dt>
                <dd>Click on "Title", "Subtitle", or "Style" to change the text. While editing, a toolbar will appear at the top, allowing you to adjust the <strong>font family</strong> and <strong>font size</strong>.</dd>
                
                <dt>Time Signature</dt>
                <dd>Click on the time signature (e.g., <code>4/4</code>) at the beginning of the sheet to change it. The number of input fields per measure will automatically adjust to the new time signature (e.g., <code>3/4</code> will show 3 fields).</dd>

                <dt>Editing Structure</dt>
                <dd>
                  <ul>
                    <li><strong>Add New Line:</strong> Click the "New Line" button at the bottom left.</li>
                    <li><strong>Delete Line:</strong> Click the large "√ó" at the end of a line. This button only appears if there is more than one line.</li>
                    <li><strong>Add Measure:</strong> If a line has fewer than four measures, a <code>+</code> button will appear at the end of the line to add a new measure.</li>
                    <li><strong>Delete Measure:</strong> Hover over a measure and click the small "√ó" at the top right. This button only appears if a line has more than one measure.</li>
                  </ul>
                </dd>

                <dt>Editing Content</dt>
                <dd>
                  <ul>
                    <li><strong>Line Text:</strong> Click in the empty area above a staff line to add annotations like "Intro", "Verse", or "Chorus". Text alignment can be controlled:
                        <ul>
                            <li><code>&lt;Verse</code>: Left-aligned</li>
                            <li><code>&gt;Chorus</code>: Right-aligned</li>
                            <li><code>Intro</code>: Centered (Default)</li>
                        </ul>
                         Additionally, the following musical symbols are automatically recognized (case-insensitive):
                        <ul>
                            <li><code>$</code>: Becomes a Segno sign (ùÑã).</li>
                            <li><code>Coda</code>: Becomes a Coda sign (ùÑå).</li>
                            <li><code>D.S.</code>: Becomes a Dal Segno sign (ùÑâ).</li>
                            <li><code>D.C.</code>: Becomes a Da Capo sign (ùÑä).</li>
                        </ul>
                    </li>
                    <li><strong>Chords in Measure:</strong> Click into a measure to show the input fields for the chords.
                        <ul>
                            <li>Enter chord symbols (e.g., <code>C</code>, <code>Gm7</code>, <code>D/F#</code>).</li>
                            <li>Use a slash <code>/</code> for a beat slash.</li>
                            <li>Enter <code>%</code> in any field to display a measure repeat sign.</li>
                            <li>Leave a field empty for a rest on that beat.</li>
                        </ul>
                    </li>
                    <li><strong>Endings (Volta Brackets):</strong> Click in the empty area <strong>above</strong> a measure to add a bracket for a 1st or 2nd ending. Enter the text (e.g., <code>1.</code> or <code>2.</code>). If adjacent measures have the same text, the brackets will automatically merge into a single longer bracket. To remove a bracket, simply clear the text.</li>
                    <li><strong>Bar Lines:</strong> Click on a bar line to edit it. Enter one of the following symbols:
                        <ul>
                           <li><code>|</code> : Single bar line</li>
                           <li><code>||</code> : Double bar line</li>
                           <li><code>|&lt;</code> : Start repeat sign</li>
                           <li><code>&gt;|</code> or <code>}</code> : End repeat sign</li>
                           <li><code>|||</code> : Final bar line</li>
                        </ul>
                    </li>
                  </ul>
                </dd>

                <dt>Export & Print - PDF Optimized</dt>
                <dd>
                    <ul>
                        <li><strong>Print / PDF:</strong> Creates a professionally formatted, print-optimized version with:
                            <ul>
                                <li>Automatic, intelligent page breaks</li>
                                <li>Consistent font sizes for best printing results</li>
                                <li>Optimized margins and spacing</li>
                                <li>Page numbers for multi-page documents</li>
                            </ul>
                        </li>
                        <li><strong>Export as PNG:</strong> Saves the lead sheet as high-resolution image file(s). For multi-page documents, a separate PNG file is created for each page.</li>
                    </ul>
                </dd>
            </dl>
        </div>
    </div>
    <script type="module" src="generator.js"></script>
  </body>
</html>
